<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Przeglądarka Tras</title>
<style type="text/css">
	*
	{
		margin: 0;
		padding: 0;
		background: rgba(0,0,0,0);
	}
	body
	{
		background: black;
		font-size: 2.5vh;
		font-family: 'Courier New', monospace;
		font-family: Arial, Helvetica, sans-serif;
	}
	nav
	{
		position: fixed;
		display: flex;
		flex-direction: row;
		flex-wrap: wrap;
		justify-content: center;
		align-items: center;
		align-content: center;
		top: 0;
		left: 0;
		width: 100%;
		height: 7vh;
		background: #2f2f2f;
		border-bottom: solid 0.3vh white;
	}
	#nowTime
	{
		min-width: 39vh;
		color: white;
		font-size: 2.9vh;
		font-weight: bold;
		letter-spacing: 0.05vh;
	}
	#nowTime span
	{
		margin-left: 0.7vh;
		margin-right: 0.7vh;
	}
	#hamburger
	{
		width: 5vh;
		height: 5vh;
	}
	.window
	{
		position: fixed;
		left: 50%;
		top:50%;
		transform: translate(-50%, -50%);
		width: 49vh;
		min-height: 30vh;
		max-height: 74vh;
		overflow-y: auto;
		overflow-x: hidden;
		padding-top: 2vh;
		padding-bottom: 2vh;
		background: #1b1b1b;
		border: solid 0.25vh #616161;
		box-shadow: 0 0 5vh 3vh black;
		color: white;
	}
	.window.hidden
	{
		display: none;
	}
	.window h1
	{
		width: 90%;
		box-sizing: border-box;
		padding: 0.7vh;
		margin: 1.5vh;
		margin-left: 5%;
		margin-right: 5%;
		text-align: center;
		background: #2f2f2f;
		border-bottom: solid 0.4vh #4d4d4d;
		font-size: 1.5em;
	}
	.window h2
	{
		width: 95%;
		box-sizing: border-box;
		padding: 0.5vh;
		margin: 1.5vh;
		margin-left: 2.5%;
		margin-right: 2.5%;
		text-align: left;
		font-weight: 100;
		background: #252525;
		border-left: solid 0.3vh #4d4d4d;
		font-size: 0.9em;
	}
	.window button, .window .button
	{
		display: inline-block;
		box-sizing: border-box;
		width: 86%;
		padding: 1.5vh;
		margin: 1.5vh;
		margin-left: 7%;
		margin-right: 7%;
		min-height: 5vh;
		text-align: center;
		font-weight: 700;
		background: #2f2f2f;
		border: solid 0.35vh #4d4d4d;
		border-radius: 1vh;
		font-size: 1.2em;
		cursor: pointer;
		color: white;
		transition: 0.3s;
	}
	.window section
	{
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		align-items: center;
		box-sizing: border-box;
		width: 100%;
	}
	.window section.hidden
	{
		display: none;
	}
	.window section .content
	{
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		align-items: center;
		box-sizing: border-box;
		width: 100%;
	}
	.separator
	{
		width: 100%;
		height: 3vh;
		opacity: 0;
	}
	#fileInput
	{
		display: none;
		font-size: 1.2em;
		padding: 10px;
		height: 7vh;
		width: auto; /* lub ustalona szerokość */
		background-color: #f5f5f5;
		color: #333;
		border: 1px solid #ccc;
		border-radius: 5px;
		cursor: pointer;
	}
	main
	{
		position: relative;
		width: 49vh;
		left: 50%;
		margin-left: -24.5vh;
		margin-top: 15vh;
		margin-bottom: 20vh;
	}
	main h1
	{
		box-sizing: border-box;
		width: 100%;
		background: #2f2f2f;
		border: solid 0.4vh white;
		border-left: none;
		border-right: none;
		margin-top: 2.5vh;
		margin-bottom: 2.5vh;
		padding: 0.7vh;
		text-align: left;
		font-size: 2.7vh;
		color: white;
	}
	main h3
	{
		box-sizing: border-box;
		width: 100%;
		background: #1b1b1b;
		border: none;
		margin-top: 0.5vh;
		margin-bottom: 0.5vh;
		padding: 0.5vh;
		text-align: left;
		font-size: 2.7vh;
		color: #4d4d4d;
	}
	main ul
	{
		width: 100%;
		box-sizing: border-box;
		background: #1b1b1b;
		border: solid 0.4vh #393939;
		border-left: none;
		border-right: none;
		margin-top: 1.7vh;
		margin-bottom: 1.7vh;
		transition: 0.5s;
	}
	main ul.markedTime
	{
		background: #252525;
		box-shadow: 0 0 0 0.1vh #b1b1b1;
	}
	main ul.markedFirm
	{
		border-color: gold;
	}
	main ul.markedFirm li .firm
	{
		color: gold;
		font-weight: bold;
	}
	main li
	{
		position: relative;
		display: flex;
		flex-direction: row;
		flex-wrap: wrap;
		justify-content: space-between;
		align-items: center;
		align-content: center;
		width: 96%;
		left: 2%;
		padding-top: 0.5vh;
		padding-bottom: 0.5vh;
		color: white;
	}
	li .nr
	{
		min-width: 7vh;
		color: #7f7f7f;
		text-align: left;
	}
	li .nr::before
	{
		content: "#";
	}
	li .difficulty
	{
		width: 2.5vh;
		height: 2.5vh;
		border-radius: 50%;
		color: black;
		font-size: 1.5vh;
		font-weight: bold;
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		align-items: center;
	}
	li .firm
	{
		min-width: 24vh;
		text-align: left;
		letter-spacing: 0.05vh;
		color: #e3e3e3;
	}
	li .hour
	{
		min-width: 9vh;
		font-weight: bold;
		color: white;
		letter-spacing: 0.05vh;
		text-align: right;
	}
	li .stopsText
	{
		width: 100%;
		color: #7f7f7f;
		text-align: left;
		font-size: 2vh;
	}
	li .stopsText span
	{
		color: white;
	}
	li .weight
	{
		min-width: 20vh;
		color: #7f7f7f;
		font-weight: bold;
		font-size: 2vh;
		text-align: center;
	}
	li .time
	{
		min-width: 12vh;
		color: #7f7f7f;
		text-align: left;
		font-weight: bold;
		font-size: 2vh;
	}
	li .gate
	{
		min-width: 10vh;
		color: #b11100;
		text-align: right;
		font-weight: bold;
		font-size: 2vh;
	}
	#route canvas
	{
		width: 100%;
		margin-top: 3vh;
	}
	#route canvas.hidden
	{
		display: none;
	}
	#route .buttons
	{
		position: relative;
		width: 90%;
		left: 5%;
		min-height: 7vh;
		background: #111111;
		border-radius: 3vh;
		align-content: center;
	}
	#route .buttons svg
	{
		width: 6vh;
		height: 6vh;
		margin: 0.5vh;
		border-radius: 50%;
		background: #252525;
		float: right;
		transition: 0.5s;
	}
	#route .buttons svg:hover
	{
		background: #2f4d00;
	}
	#routeText
	{
		width: 100%;
		margin-top: 3vh;
		margin-bottom: 2vh;
		font-family: "Courier New", monospace;
		font-size: 1.7vh;
		padding: 1.5vh;
	}
	#routeText.hidden
	{
		display: none;
	}
	.close
	{
		position: absolute;
		z-index: 2;
		top: 1.5vh;
		right: 1.5vh;
		width: 4.5vh;
		height: 4.5vh;
		background: #b11100;
		border: solid 0.4vh #1b1b1b;
		box-shadow: 0 0 0vh 0.3vh #b11100;
		border-radius: 0.4vh;
		text-align: center;
		align-content: center;
	}
	.close::before
	{
		content: "X";
		font-size: 3.5vh;
		font-weight: bold;
		color: #1b1b1b;
	}
	#firm
	{
		position: relative;
		width: 100%;
		left: 3vh;
	}
	.myRoutes
	{
		border-color: gold;
	}
</style>
<script>
	async function sleep(ms)
	{
		return new Promise(resolve => setTimeout(resolve, ms));
	}
	const setings =
	{
		markedFirm: localStorage.getItem("agroTrasy-setings:markedFirm")||"X",
	}
	const data =
	{
		itinerary: JSON.parse(localStorage.getItem("agroTrasy-data:itinerary"))||[],
		markedItinerary: Number(localStorage.getItem("agroTrasy-data:markedItinerary")),
		availableGates: JSON.parse(localStorage.getItem("agroTrasy-data:availableGates"))||[0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],
		myRoutes: JSON.parse(localStorage.getItem("agroTrasy-data:myRoutes"))||[],
		myLastRoute: JSON.parse(localStorage.getItem("agroTrasy-data:myLastRoute"))||0,
	}
	const load =
	{
		start: function()
		{
			refreshNowDay()
			refreshNowHour()
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.has('r'))
			{
				const routeParam = urlParams.get('r');
				const route = link.decode(routeParam)
				if (route)
				{
					create.route(route)
					document.getElementById("route").getElementsByClassName("close")[0].remove()
					document.getElementById("hamburger").remove()
					return
				}
			}
			document.getElementById('fileInput').addEventListener('change', load.handleFile);
			function refreshNowDay()
			{
				const nowDay = document.getElementById("nowDay")
				nowDay.innerHTML = dateText()
				setTimeout(refreshNowDay,120000)
			}
			function refreshNowHour()
			{
				const nowHour = document.getElementById("nowHour")
				nowHour.dataset.separator = Math.abs((nowHour.dataset.separator||0)-1)
				const date = new Date()
				nowHour.innerHTML = `${addZero(date.getHours())}<span style="opacity:${Number(nowHour.dataset.separator)||0.3};">:</span>${addZero(date.getMinutes())}`
				if ((Date.now()/(3600000)) - Number(((data.itinerary||[])[data.markedItinerary||0]||{}).start) < 24)
				{
					const routes = document.getElementsByTagName("main")[0].getElementsByTagName("ul")
					for (const rout of routes)
					{
						const space = timeSpace(`${addZero(date.getHours())}:${addZero(date.getMinutes())}`,rout.dataset.time||"03:30")
						if (space < 31)
						{
							rout.classList.add("markedTime")
							continue
						}
						else if (space > 1435)
						{
							rout.classList.add("markedTime")
							continue
						}
						else
						{
							rout.classList.remove("markedTime")
						}
					}
				}
				setTimeout(refreshNowHour,1200)
			}
			const buttons = document.getElementsByClassName("close")
			for (const button of buttons)
			{
				button.onclick = function(event)
				{
					const divWindow = event.currentTarget.offsetParent
					divWindow.classList.add("hidden")
				}
			}
			load.loadMenu()
			const list = (data.itinerary||[])[data.markedItinerary]
			if (!list || (Date.now()/(1000*60*60)) - list.start > 18)
			{
				document.getElementById("inputWindow").classList.remove("hidden")
			}
			else if (list)
			{
				create.itinerary(list)
			}
		},
		handleFile: function()
		{
			const files = event.target.files;
			for (const file of files)
			{
				const reader = new FileReader();
				if (!file || !file.name){continue}
				else
				{
					const fileName = file.name
					if (file.name.toLowerCase().endsWith('.csv'))
					{
						reader.onload = (file)=>{addList(load.readFile(file,','),fileName)};
					}
					else if (file.name.toLowerCase().endsWith('.tsv'))
					{
						reader.onload = (file)=>{addList(load.readFile(file,'\t'),fileName)};
					}
					reader.readAsText(file);
				}
			}
		},
		readFile: function(file,separator)
		{
			if (!file){debugger;return}//zabezpieczenie
			const text = file.target.result;
			const lines = text.split(/\r\n|\n/);
			const result = lines.map(line => line.split(separator||","));
			const giveBack = []
			//usuwanie pustych linijek
			for (const row of (result||[]))
			{
				let push = 0
				for (const cell of (row||[]))
				{
					if (cell)
					{
						push = 1
						break
					}
				}
				if (push)
				{
					giveBack.push(row)
				}
			}
			return load.readItinerary(giveBack)
		},
		readItinerary: function(file)
		{
			if (!Array.isArray(file)){debugger;return}
			const scheme = {}
			for (let i=0 ; i<(file[0]||[]).length ; i++)
			{
				const cell = file[0][i]
				//analizowanie nagłówków kolumn
				if (/^(lp|nr)\.?$/i.test(cell))
				{
					if (scheme.nr){debugger}
					scheme.nr = i+1
				}
				else if (/przewoźnik/i.test(cell))
				{
					if (scheme.firm){debugger}
					scheme.firm = i+1
				}
				else if (/(data|godzina|załadune?ku?)/i.test(cell))
				{
					if (scheme.date){debugger}
					scheme.date = i+1
				}
				else if (/(lista|przystanki?(ów)?|sklepy|trasa)/i.test(cell))
				{
					if (scheme.stops){debugger}
					scheme.stops = i+1
				}
			}
			if (!(scheme.date && scheme.stops)){debugger;return}
			const gates = []
			for (let i=0 ; i<data.availableGates.length ; i++)
			{
				if (data.availableGates[i])
				{
					gates.push(i)
				}
			}
			const listOfRoutes = {list:[]}
			for (let i=1 ; i<file.length ; i++)
			{
				if (Array.isArray(file[i]))
				{
					listOfRoutes.list.push(createRoute(file[i],i))
				}
			}
			listOfRoutes.start = 0
			let end = 0
			listOfRoutes.totalTotalWeight = 0
			for (let i=0 ; i<(listOfRoutes.list||[]).length ; i++)
			{
				if (listOfRoutes.list[i].date)
				{
					if (!listOfRoutes.start || listOfRoutes.list[i].date < listOfRoutes.start)
					{
						listOfRoutes.start = listOfRoutes.list[i].date
					}
					if (!end || listOfRoutes.list[i].date > end)
					{
						end = listOfRoutes.list[i].date
					}
				}
				listOfRoutes.totalTotalWeight += Number(listOfRoutes.list[i].totalWeight)||0
			}
			listOfRoutes.next = Math.max(0,end - listOfRoutes.start)
			listOfRoutes.totalTotalWeight = Math.round(listOfRoutes.totalTotalWeight)
			return listOfRoutes
			function createRoute(row,rowIndex)
			{
				const route = {}
				if (scheme.nr)
				{
					route.nr = Number(row[scheme.nr-1]) || rowIndex
				}
				else
				{
					route.nr = rowIndex
				}
				route.gate = gates[(route.nr-1)%gates.length]
				if (scheme.firm)
				{
					route.firm = row[scheme.firm-1] || "NIEZNANY"
				}
				else
				{
					route.firm = "NIEZNANY"
				}
				route.date = new Date(row[scheme.date-1])
				route.hour = "14:04"
				if (Number(route.date))
				{
					route.hour = `${addZero(route.date.getHours())}:${addZero(route.date.getMinutes())}`
				}
				route.date = Math.floor((Number(route.date)||0)/(1000*60*60))
				const stops = row[scheme.stops-1].match(/\[\d{2}:\d{2}\][^\[\]-]+(?:\[[^-]+?\])?\[[^-]*?\/[\d\.,]+(?:kg)?\](?:-)?/g)
				route.stops = []
				route.totalWeight = 0
				route.totalPallets = 0
				route.totalSpace = 0
				for (let i=0 ; i<stops.length ; i++)
				{
					const match = stops[i]
					const stop = {}
					stop.hour = ((match.match(/\[(?<hour>\d{2}:\d{2})\]/)||{}).groups||{}).hour||"14:04"
					stop.name = ((match.match(/(?:^|\])\s*(?<name>[^\[\]]+?)\s*(?=\[|$)/i)||{}).groups||{}).name||"NIEZNANY"
					stop.type = ((match.match(/\[(?<type>[^ ][^ ]?[^ ]?)\]/i)||{}).groups||{}).type||"X"
					stop.pallets = Number(((match.match(/\[(?:[^\[\]]+:)?(?<pallets>\d+(?:[\.,]\d+)?)\/\d+(?:[\.,]\d+)?\]/i)||{}).groups||{}).pallets)||1
					stop.pallets = Math.round(stop.pallets*2)
					stop.weight = Number(((match.match(/\[(?:[^\[\]]+:)?\d+(?:[\.,]\d+)?\/(?<weight>\d+(?:[\.,]\d+)?)\]/i)||{}).groups||{}).weight)||404
					route.stops.push(stop)
				}
				for (let i=0 ; i<route.stops.length ; i++)
				{
					if (i === 0)
					{
						route.stops[0].space = timeSpace(route.hour,route.stops[0].hour)
						route.totalSpace += route.stops[0].space * 2
					}
					else
					{
						route.stops[i].space = timeSpace(route.stops[i-1].hour,route.stops[i].hour)
						route.totalSpace += route.stops[i].space
						//route.stops[i].space = Math.max(1,route.stops[i].space-10)
					}
					route.totalWeight += route.stops[i].weight
					route.stops[i].weight = (Math.round(route.stops[i].weight/10)/10)
					route.totalPallets += route.stops[i].pallets
				}
				route.totalWeight = Math.round(route.totalWeight/100)/10
				route.totalSpace = Math.round(route.totalSpace)
				route.space = Math.round(timeSpace(route.stops[0].hour,route.stops[route.stops.length-1].hour))+30
				const keys = route.stops.filter(stop => stop.type === "X").length;
				const doors = route.stops.filter(stop => (stop.type != "X" && stop.type != "K")).length;
				route.difficulty = calcDifficulty(route.space,route.totalSpace,route.totalWeight,route.totalPallets,route.stops.length,keys,doors)
				return route
			}
		},
		loadMenu: function()
		{
			document.getElementById("hamburger").onclick = changeMenu
			const buttons = document.getElementById("menu").getElementsByTagName("button")
			for (let button of buttons)
			{
				button.onclick = changeMenu
			}
			function changeMenu(event)
			{
				if (!event){console.log("funkcja uruchamiana tylko z event")}
				const sections = document.getElementById("menu").getElementsByTagName("section")
				const action = event.currentTarget.dataset.action
				const path = event.currentTarget.dataset.path
				if (action)
				{
					menuActions[action](event.currentTarget.dataset.other)
				}
				if (path === "menu")
				{
					const menu = document.getElementById("menu")
					if (Number(menu.dataset.open))
					{
						menu.classList.add("hidden")
						menu.dataset.open = 0
					}
					else
					{
						document.getElementById("inputWindow").classList.add("hidden")
						document.getElementById("route").classList.add("hidden")
						menu.classList.remove("hidden")
						menu.dataset.open = 1
						for (const section of sections)
						{
							if (section.id == "main")
							{
								section.classList.remove("hidden")
							}
							else
							{
								section.classList.add("hidden")
							}
						}
					}
				}
				else if (path)
				{
					for (const section of sections)
					{
						if (section.id == path)
						{
							section.classList.remove("hidden")
						}
						else
						{
							section.classList.add("hidden")
						}
					}
				}
			}
		}
	}
	const menuActions=
	{
		loadFile: function()
		{
			menu.classList.add("hidden")
			menu.dataset.open = 0
			document.getElementById("inputWindow").classList.remove("hidden")
		},
		history: function()
		{
			const content = document.getElementById("history").getElementsByClassName("content")[0]
			content.innerHTML = ""
			for (let i=0 ; i<(data.itinerary||[]).length ; i++)
			{
				const button = document.createElement("button")
				button.innerHTML = dateText((data.itinerary[i]||{}).start)
				button.onclick = function()
				{
					menu.classList.add("hidden")
					menu.dataset.open = 0
					data.markedItinerary = i
					create.itinerary(data.itinerary[data.markedItinerary])
				}
				content.appendChild(button)
			}
		},
		markedFirm: function()
		{
			const content = document.getElementById("markedFirm").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const firms = []
			const routes = document.getElementsByTagName("main")[0].getElementsByTagName("ul")
			for (const rout of routes)
			{
				if (rout.dataset.firm && !firms.includes(rout.dataset.firm))
				{
					firms.push(rout.dataset.firm)
				}
			}
			firms.sort()
			for (let i=0 ; i<firms.length ; i++)
			{
				const button = document.createElement("button")
				button.innerHTML = firms[i]
				button.onclick = function()
				{
					menu.classList.add("hidden")
					menu.dataset.open = 0
					setings.markedFirm = firms[i]
					localStorage.setItem("agroTrasy-setings:markedFirm",setings.markedFirm)
					create.markedFirm()
				}
				content.appendChild(button)
			}
		},
		myRoutes: function()
		{
			menu.classList.add("hidden")
			menu.dataset.open = 0
			const main = document.getElementsByTagName("main")[0]
			main.innerHTML = ""
			for (const month of (data.myRoutes||[]))
			{
				if (!Array.isArray(month.days)){continue}
				if (month.days.length<1){continue}
				const h1 = create.element("h1")
				main.appendChild(h1)
				let points = [0,0]
				let weightMonth = 0
				let stopsMonth = 0
				let palletsMonth = 0
				for (let nr = month.days.length-1 ; nr>=0 ; nr--)
				{
					const day = month.days[nr]
					if ((day||[])[0])
					{
						if (day[0].date)
						{
							const h3 = create.element("h3")
							h3.innerHTML = dateText(day[0].date)
							main.appendChild(h3)
						}
						for (let route of day)
						{
							weightMonth += route.totalWeight
							stopsMonth += route.stops.length
							palletsMonth += route.totalPallets
							points[0] += route.difficulty
							points[1] ++
							const ul = create.element("ul")
							ul.dataset.firm = route.firm||"X"
							ul.dataset.route = JSON.stringify(route)
							ul.dataset.time = route.hour || "18:00"
							ul.onclick = function(event)
							{
								const line = JSON.parse(event.currentTarget.dataset.route)
								create.route(line,line.date,"myRoutes")
							}
							const li = []
							for (let i=0 ; i<3 ; i++)
							{
								li[i] = create.element("li")
								ul.appendChild(li[i])
							}
							const difficulty = create.element("div","difficulty")
							li[0].appendChild(difficulty)
							if (route.difficulty < 55)
							{
								difficulty.style.background = "#aeff3d"
							}
							else if (route.difficulty > 75)
							{
								difficulty.style.background = "#c20000"
							}
							else
							{
								// zakres od 55 do 75
								const c = Math.floor(route.difficulty)-55
								difficulty.style.background = `hsl(${82-(c*4)},100%,${60-(c)}%)`
							}
							difficulty.innerHTML = Math.round(Number(route.difficulty)||0)
							const nr = create.element("div","nr")
							li[0].appendChild(nr)
							nr.innerHTML = route.nr || "?"
							const firm = create.element("div","firm")
							li[0].appendChild(firm)
							firm.innerHTML = route.firm || "???"
							const hour = create.element("div","hour")
							li[0].appendChild(hour)
							hour.innerHTML = route.hour || "XX:XX"
							const stopsText = create.element("div","stopsText")
							li[1].appendChild(stopsText)
							if (route.stops.length === 1)
							{
								stopsText.innerHTML = `<span>${create.nameCompression(route.stops[0].name,24)}</span>`
							}
							else if (route.stops.length === 2)
							{
								stopsText.innerHTML = `<span>${create.nameCompression(route.stops[0].name,14)}</span> > <span>${create.nameCompression(route.stops[1].name,14)}</span>`
							}
							else if (route.stops.length > 2)
							{
								let maxWeightStop = route.stops[1]
								for (let i=2 ; i<route.stops.length-1 ; i++)
								{
									if (route.stops[i].weight > maxWeightStop.weight)
									{
										maxWeightStop = route.stops[i]
									}
								}
								stopsText.innerHTML = `${route.stops.length}: <span>${create.nameCompression(route.stops[0].name,12)}</span> > <span>${create.nameCompression(maxWeightStop.name)}</span> > <span>${create.nameCompression(route.stops[route.stops.length-1].name)}</span>`
							}
							const time = create.element("div","time")
							li[2].appendChild(time)
							time.innerHTML = `${Math.round(route.totalSpace/60)}H (${Math.floor(route.space/60)}H ${addZero(Math.floor((route.space%60)))})`
							const weight = create.element("div","weight")
							li[2].appendChild(weight)
							weight.innerHTML = `${route.totalWeight} t. / ${route.totalPallets} pal.`
							const gate = create.element("div","gate")
							li[2].appendChild(gate)
							gate.innerHTML = `R ${route.gate||"?"}`
							main.appendChild(ul)
						}
					}
				}
				if (points[1]>0)
				{
					h1.innerHTML = `${["Gryczeń","Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","październik","Listopad","Grudzień","WTFyczeń"][month.month]} ${month.year}r.<br>${Math.round(points[0])}pkt / ${points[1]} = ${Math.round(points[0]/(points[1]||1))}pkt<br>${Math.round(weightMonth*10)/10} t. / ${Math.round(palletsMonth)} pal. / ${Math.round(stopsMonth)} skl.`
				}
				else
				{
					h1.remove()
				}
			}
		},
		myRoute: function()
		{
			menu.classList.add("hidden")
			menu.dataset.open = 0
			if (data.myLastRoute)
			{
				create.route(data.myLastRoute,0,"myRoutes")
			}
		},
		routesNow: function()
		{
			menu.classList.add("hidden")
			menu.dataset.open = 0
			for (let i=0 ; i<data.itinerary.length ; i++)
			{
				if (data.itinerary[i])
				{
					data.markedItinerary = i
					create.itinerary(data.itinerary[data.markedItinerary])
					return
				}
			}
		},
		shareAll: function()
		{
			const content = document.getElementById("shareAll").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const line = data.itinerary[data.markedItinerary]
			const h2 = document.createElement("h2")
			if (line && typeof line==="object")
			{
				h2.innerHTML = `Trasy z dnia ${dateText(line.start)} - ${dateText(line.start+line.next)}<br><br>`
				for (let route of line.list)
				{
					h2.innerHTML += `${route.nr}: ${(route.stops[0]||{}).name||"???"} ${route.firm} ${route.hour}<br>`
					h2.innerHTML += `${link.create(route)}<br><br>`
				}
			}
			content.appendChild(h2)
			setTimeout(()=>{navigator.clipboard.writeText(h2.innerText || h2.textContent)},2)
		},
		shareFirm: function()
		{
			const content = document.getElementById("shareAll").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const line = data.itinerary[data.markedItinerary]
			const h2 = document.createElement("h2")
			if (line && typeof line==="object")
			{
				h2.innerHTML = `Trasy z dnia ${dateText(line.start)} - ${dateText(line.start+line.next)}<br><br>`
				for (let route of line.list)
				{
					if (setings.markedFirm === route.firm)
					{
						h2.innerHTML += `${route.nr}: ${(route.stops[0]||{}).name||"???"} ${route.hour}<br>`
						h2.innerHTML += `${link.create(route)}<br><br>`
					}
				}
			}
			content.appendChild(h2)
			setTimeout(()=>{navigator.clipboard.writeText(h2.innerText || h2.textContent)},2)
		},
		ends: function()
		{
			const content = document.getElementById("ends").getElementsByClassName("content")[0]
			content.innerHTML = ""
			if (!data.itinerary[data.markedItinerary]){return}
			const line = JSON.parse(JSON.stringify(data.itinerary[data.markedItinerary]))
			if (!Array.isArray(line.list)){return}
			for (let route of line.list)
			{
				route.endDate = new Date(route.date*(60*60*1000))
				route.endDate.setHours(Number(route.hour.slice(0,2)))
				route.endDate.setMinutes(Number(route.hour.slice(3,5)) + route.totalSpace)
				const targetDate = new Date(route.date*(60*60*1000))
				targetDate.setHours(18,0,0,0)
				route.end = Math.max(Math.round((route.endDate - targetDate)/(1000*60)))
				if (route.end < 0)
				{
					route.end += (60*24)
				}
				if (route.end > 6*60)
				{
					const h = route.end - (6*60)
					route.endName = `${addZero(Math.floor(h/60))}:${addZero(h%60)}`
				}
				else
				{
					const h = route.end + (18*60)
					route.endName = `${addZero(Math.floor(h/60))}:${addZero(h%60)}`
				}
			}
			const ends = []
			for (let i=0 ; i<line.list.length ; i++)
			{
				const min = [0,24*60]
				for (let j=0 ; j<line.list.length ; j++)
				{
					if (!line.list[j].flag)
					{
						if (line.list[j].end < min[1])
						{
							min[1] = line.list[j].end
							min[0] = j
						}
					}
				}
				ends.push(line.list[min[0]])
				line.list[min[0]].flag = true
			}
			if (true)
			{
				const h2 = document.createElement("h2")
				h2.innerHTML = "Kolejność przyjazdu:<br>"
				for (let i=0 ; i<ends.length ; i++)
				{
					h2.innerHTML += `${i+1}. ${ends[i].firm} -  ${create.nameCompression((ends[i].stops[0]||{}).name||"???",5)} (${ends[i].endName})<br>`
				}
				content.appendChild(h2)
				const button = document.createElement("button")
				button.innerHTML = "kopiuj"
				button.onclick = function()
				{
					navigator.clipboard.writeText(h2.innerText || h2.textContent)
				}
				content.appendChild(button)
			}
			const hours = []
			for (let i=0 ; i<ends.length ; i++)
			{
				const index = Math.floor(ends[i].end/10)
				for (let j=index-6 ; j<index+7 ; j++)
				{
					if (j>0)
					{
						if (!hours[j])
						{
							hours[j] = 0
						}
						hours[j] += [0.45, 0.35, 0.30, 0.20, 0.10, 0.05, 0.05, 0.2, 0][Math.abs(index-j)]
					}
				}
			}
			if (true)
			{
				const h2 = document.createElement("h2")
				h2.innerHTML = "Szansa na kolejkę:<br>"
				let c = 0
				let bufor = ""
				for (let i=0 ; i<hours.length ; i++)
				{
					let procent = 0
					if (hours[i]>1)
					{
						procent = 1 / (1 + Math.exp(-0.7 * ((hours[i]||0) - 1)));
					}
					else
					{
						procent = 1 / (1 + Math.exp(-5 * ((hours[i]||0) - 1)));
					}
					if (i<36)
					{
						h2.innerHTML += `${addZero(Math.floor(((i+(18*6))*10)/60))}:${addZero(((i+(18*6))*10)%60)} &nbsp ${addZero(Math.floor(procent*100))}% ${"!".repeat(Math.floor(40*procent))}<br>`
					}
					else
					{
						h2.innerHTML += `${addZero(Math.floor(((i-36)*10)/60))}:${addZero(((i-36)*10)%60)} &nbsp ${addZero(Math.floor(procent*100))}% ${"!".repeat(Math.floor(40*procent))}<br>`
					}
				}
				content.appendChild(h2)
			}
		},
		ramps: function()
		{
			const content = document.getElementById("ramps").getElementsByClassName("content")[0]
			content.innerHTML = ""
			for (let i=1 ; i<data.availableGates.length ; i++)
			{
				const button = document.createElement("button")
				button.dataset.ramp = i
				button.innerHTML = `rampa ${i} ${["nieaktywna","aktywna"][data.availableGates[i]]}`
				button.style.borderColor = ["red","green"][data.availableGates[i]]
				button.onclick = function(event)
				{
					const button = event.currentTarget
					const i = Number(button.dataset.ramp)
					data.availableGates[i] = Math.abs(data.availableGates[i]-1)
					localStorage.setItem("agroTrasy-data:availableGates",JSON.stringify(data.availableGates))
					button.innerHTML = `rampa ${i} ${["nieaktywna","aktywna"][data.availableGates[i]]}`
					button.style.borderColor = ["red","green"][data.availableGates[i]]
				}
				content.appendChild(button)
			}
		},
		newStops: function()
		{
			const content = document.getElementById("newStops").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const h2 = document.createElement("h2")
			h2.innerHTML = "Nowe sklepy:<br><br>"
			content.appendChild(h2)
			for (let i=0 ; i<data.itinerary.length-1 ; i++)
			{
				let text = ""
				const stops = [[],[]]
				for (let j=0 ; j<data.itinerary[i].list.length ; j++)
				{
					for (let k=0 ; k<data.itinerary[i].list[j].stops.length ; k++)
					{
						stops[0].push(data.itinerary[i].list[j].stops[k].name)
					}
				}
				for (let j=0 ; j<data.itinerary[i+1].list.length ; j++)
				{
					for (let k=0 ; k<data.itinerary[i+1].list[j].stops.length ; k++)
					{
						stops[1].push(data.itinerary[i+1].list[j].stops[k].name)
					}
				}
				for (let stop of stops[0])
				{
					for (let j=0 ; j<stops[1].length+1 ; j++)
					{
						if (j === stops[1].length)
						{
							text += ` - ${stop}<br>`
						}
						else if (stop === stops[1][j])
						{
							break
						}
					}
				}
				if (text.length>1)
				{
					h2.innerHTML += `------- ${dateText(data.itinerary[i].start)} -------<br>${text}<br>`
				}
			}
			const button = document.createElement("button")
			button.innerHTML = "kopiuj"
			button.onclick = function()
			{
				navigator.clipboard.writeText(h2.innerText || h2.textContent)
			}
			content.appendChild(button)
		},
		chartWeight: function()
		{
			const content = document.getElementById("chart").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const h2 = document.createElement("h2")
			h2.innerHTML = "Tonaż w czasie:<br><br>"
			content.appendChild(h2)
			let minWeight = 0
			let maxWeight = 0
			for (let i=0 ; i<data.itinerary.length ; i++)
			{
				if (minWeight < 1 || data.itinerary[i].totalTotalWeight < minWeight)
				{
					minWeight = data.itinerary[i].totalTotalWeight
				}
				if (data.itinerary[i].totalTotalWeight > maxWeight)
				{
					maxWeight = data.itinerary[i].totalTotalWeight
				}
			}
			for (let i=0 ; i<data.itinerary.length ; i++)
			{
				const chart = Math.round((Math.max(0,data.itinerary[i].totalTotalWeight-minWeight)/(maxWeight-minWeight))*42)
				h2.innerHTML += `${dateText(data.itinerary[i].start)}: ${data.itinerary[i].totalTotalWeight}t.<br>${"!".repeat(chart+2)}<br><br>`
			}
			const button = document.createElement("button")
			button.innerHTML = "kopiuj"
			button.onclick = function()
			{
				navigator.clipboard.writeText(h2.innerText || h2.textContent)
			}
			content.appendChild(button)
		},
		chartDifficulty: function()
		{
			const content = document.getElementById("chart").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const h2 = document.createElement("h2")
			h2.innerHTML = "Średnia trudność tras w czasie:<br><br>"
			content.appendChild(h2)
			let minDifficulty = 0
			let maxDifficulty = 0
			const listDifficulty = []
			for (let i=0 ; i<data.itinerary.length ; i++)
			{
				listDifficulty[i] = [0,0];
				for (const route of data.itinerary[i].list)
				{
					if (route)
					{
						listDifficulty[i][0] += route.difficulty
						listDifficulty[i][1] ++
					}
				}
				listDifficulty[i] = Math.round(listDifficulty[i][0]/(listDifficulty[i][1]||1))
				if (minDifficulty < 1 || listDifficulty[i] < minDifficulty)
				{
					minDifficulty = listDifficulty[i]
				}
				if (listDifficulty[i] > maxDifficulty)
				{
					maxDifficulty = listDifficulty[i]
				}
			}
			for (let i=0 ; i<data.itinerary.length ; i++)
			{
				const chart = Math.round((Math.max(0,listDifficulty[i]-minDifficulty)/(maxDifficulty-minDifficulty))*42)
				h2.innerHTML += `${dateText(data.itinerary[i].start)}: ${listDifficulty[i]}pkt.<br>${"!".repeat(chart+2)}<br><br>`
			}
			const button = document.createElement("button")
			button.innerHTML = "kopiuj"
			button.onclick = function()
			{
				navigator.clipboard.writeText(h2.innerText || h2.textContent)
			}
			content.appendChild(button)
		},
		downloadAll: async function()
		{
			menu.classList.add("hidden")
			menu.dataset.open = 0
			//
			const line = data.itinerary[data.markedItinerary]
			if (line && typeof line==="object")
			{
				for (let route of line.list)
				{
					const canvas = create.route(route,line.start)
					await sleep(200)
					downloadCanvas(canvas,`${(route.stops[0]||{}).name||"trasa bez nazwy"} ${dateText(route.date)||""}`)
				}
			}
			document.getElementById("route").classList.add("hidden")
		},
		downloadFirm: async function()
		{
			menu.classList.add("hidden")
			menu.dataset.open = 0
			//
			const line = data.itinerary[data.markedItinerary]
			if (line && typeof line==="object")
			{
				for (let route of line.list)
				{
					if (setings.markedFirm === route.firm)
					{
						const canvas = create.route(route,line.start)
						await sleep(200)
						downloadCanvas(canvas,`${(route.stops[0]||{}).name||"trasa bez nazwy"} ${dateText(route.date)||""}`)
					}
				}
			}
			document.getElementById("route").classList.add("hidden")
		},
		findDouble: function()
		{
			const content = document.getElementById("double").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const h2 = document.createElement("h2")
			h2.innerHTML = "Możliwe duble:<br><br>"
			content.appendChild(h2)
			const line = JSON.parse(JSON.stringify(data.itinerary[data.markedItinerary]))
			if (!Array.isArray(line.list)){return}
			for (let i=0 ; i<line.list.length ; i++)
			{
				for (let j=i+1 ; j<line.list.length ; j++)
				{
					const r = [line.list[i],line.list[j]]
					if (r[0].firm === r[1].firm)
					{
						if (r[0].totalSpace + r[1].totalSpace < (15.5*60))
						{
							const space = timeSpace(r[0].stops[r[0].stops.length-1].hour,r[1].hour)
							const maxSpace = timeSpace(r[0].hour,r[0].stops[0].hour)+(1.5*60)
							const minSpace = Math.max(20,timeSpace(r[0].hour,r[0].stops[0].hour)/2)
							if (space>minSpace && space<maxSpace)
							{
								h2.innerHTML+= `<br>${r[0].firm}:<br>`
								h2.innerHTML+= ` - ${r[0].hour} ${r[0].stops[0].name}<br>`
								h2.innerHTML+= ` - ${r[1].hour} ${r[1].stops[0].name}<br>`
							}
						}
					}
				}
			}
			const button = document.createElement("button")
			button.innerHTML = "kopiuj"
			button.onclick = function()
			{
				navigator.clipboard.writeText(h2.innerText || h2.textContent)
			}
			content.appendChild(button)
		},
		itineraryText: function()
		{
			const content = document.getElementById("itineraryText").getElementsByClassName("content")[0]
			content.innerHTML = ""
			const h2 = document.createElement("h2")
			content.appendChild(h2)
			const line = JSON.parse(JSON.stringify(data.itinerary[data.markedItinerary]))
			if (!Array.isArray(line.list)){return}
			h2.innerHTML = `${dateText(line.start)} ${line.totalTotalWeight}t.<br><br>`
			for (route of line.list)
			{
				h2.innerHTML += `${route.hour||"?"} - #${route.nr||"?"} ${route.firm||"?"}<br>`
				if (route.stops.length === 1)
				{
					h2.innerHTML += `${create.nameCompression(route.stops[0].name,24)}<br>`
				}
				else if (route.stops.length === 2)
				{
					h2.innerHTML += `${create.nameCompression(route.stops[0].name,14)} > ${create.nameCompression(route.stops[1].name,14)}<br>`
				}
				else if (route.stops.length > 2)
				{
					let maxWeightStop = route.stops[1]
					for (let i=2 ; i<route.stops.length-1 ; i++)
					{
						if (route.stops[i].weight > maxWeightStop.weight)
						{
							maxWeightStop = route.stops[i]
						}
					}
					h2.innerHTML += `${route.stops.length}: ${create.nameCompression(route.stops[0].name,12)} > ${create.nameCompression(maxWeightStop.name)} > ${create.nameCompression(route.stops[route.stops.length-1].name)}<br>`
				}
				h2.innerHTML += `${Math.round(route.totalSpace/60)}H (${Math.floor(route.space/60)}H ${addZero(Math.floor((route.space%60)))}) ${route.totalWeight} t/${route.totalPallets}pal. R${route.gate||"?"}<br>`
				h2.innerHTML += "<br>"
			}
			const button = document.createElement("button")
			button.innerHTML = "kopiuj"
			button.onclick = function()
			{
				navigator.clipboard.writeText(h2.innerText || h2.textContent)
			}
			content.appendChild(button)
		},
	}
	function dateText(dateValue)
	{
		dateValue *= (1000*60*60)
		dateValue = new Date(dateValue||Date.now())
		return `${["Nd","Pn","Wt","Śr","Cz","Pt","Sb","WTF"][dateValue.getDay()]} ${addZero(dateValue.getDate())}.${addZero(dateValue.getMonth()+1)}.${`${dateValue.getFullYear()}`.slice(2,4)}r`
	}
	function addList(list,fileName)
	{
		if (list && typeof list === "object")
		{
			let add = 1
			for (let i=0 ; i<(data.itinerary||[]).length ; i++)
			{
				if (data.itinerary[i].start === list.start)
				{
					data.markedItinerary = i
					data.itinerary[data.markedItinerary] = list
					add = 0
					break
				}
			}
			if (add)
			{
				data.markedItinerary = 0
				data.itinerary.unshift(list)
				data.itinerary = data.itinerary.slice(0,15)
				localStorage.setItem("agroTrasy-data:itinerary",JSON.stringify(data.itinerary))
			}
			localStorage.setItem("agroTrasy-data:markedItinerary",Number(data.markedItinerary)||0)
			create.itinerary(data.itinerary[data.markedItinerary])
		}
		else
		{
			console.error(`nie udało się wczytać pliku o nazwie: ${fileName}`)
		}
		document.getElementById("inputWindow").classList.add("hidden")
	}
	function addZero(value)
	{
		value = `${value}`
		for (let i=0 ; i<2 ; i++)
		{
			if (value.length<2)
			{
				value = `0${value}`
			}
			else
			{
				break
			}
		}
		return value
	}
	function timeSpace(time,time2)
	{
		if (!Array.isArray(time))
		{
			time = [time,time2]
		}
		for (let i=0 ; i<2 ; i++)
		{
			hour = time[i].split(':').map(Number);
			time[i] = (hour[0]*60) + hour[1]
		}
		let space = time[1] - time[0]
		if (space < 0)
		{
			space += 24*60
		}
		return space
	}
	function calcDifficulty(space,totalSpace,weight,pallets,stops,keys,doors)
	{
		let difficulty = 3
		difficulty += space/15
		difficulty += totalSpace/25
		if (totalSpace > (9.5*60))
		{
			difficulty += 1
		}
		difficulty += weight
		difficulty += pallets/4
		if (pallets > 24)
		{
			difficulty += (pallets-24)/5
		}
		difficulty += stops/4
		difficulty += doors/5
		difficulty += keys/4
		return Math.round(difficulty*10)/10
	}
	function downloadCanvas(canvas,name)
	{
		const dataURL = canvas.toDataURL('image/png');
		const link = document.createElement('a');
		link.href = dataURL;
		link.download = `${name}.png`;
		link.click();
    }
	const create =
	{
		itinerary: function(line)
		{
			const main = document.getElementsByTagName("main")[0];
			main.innerHTML = "";
			const h1 = create.element("h1");
			let totalPallets = 0;
			let totalShops = 0;
			for (const route of line.list)
			{
				totalPallets += route.totalPallets;
				totalShops += route.stops.length;
			}
			h1.innerHTML = `${dateText(line.start)} - ${dateText(line.start+line.next)}<br><span style="color:gold;">${line.totalTotalWeight} t.</span> &nbsp; ${totalPallets} palet ${totalShops} sklepów`;
			main.appendChild(h1)
			for (const route of line.list)
			{
				const ul = create.element("ul")
				ul.dataset.firm = route.firm||"X"
				ul.dataset.route = JSON.stringify(route)
				ul.dataset.time = route.hour || "18:00"
				ul.dataset.start = line.start
				ul.onclick = function(event)
				{
					const line = JSON.parse(event.currentTarget.dataset.route)
					const dateLine = Number(event.currentTarget.dataset.start)
					create.route(line,dateLine)
				}
				const li = []
				for (let i=0 ; i<3 ; i++)
				{
					li[i] = create.element("li")
					ul.appendChild(li[i])
				}
				const difficulty = create.element("div","difficulty")
				li[0].appendChild(difficulty)
				if (true)
				{
					// zakres od 45 do 75
					const c = Math.min(30,Math.max(0,Math.floor(route.difficulty)-45))
					difficulty.style.background = `hsl(${90-(c*3)},100%,${65-(c)}%)`
				}
				difficulty.innerHTML = Math.round(Number(route.difficulty)||0)
				const nr = create.element("div","nr")
				li[0].appendChild(nr)
				nr.innerHTML = route.nr || "?"
				const firm = create.element("div","firm")
				li[0].appendChild(firm)
				firm.innerHTML = route.firm || "???"
				const hour = create.element("div","hour")
				li[0].appendChild(hour)
				hour.innerHTML = route.hour || "XX:XX"
				const stopsText = create.element("div","stopsText")
				li[1].appendChild(stopsText)
				if (route.stops.length === 1)
				{
					stopsText.innerHTML = `<span>${create.nameCompression(route.stops[0].name,24)}</span>`
				}
				else if (route.stops.length === 2)
				{
					stopsText.innerHTML = `<span>${create.nameCompression(route.stops[0].name,14)}</span> > <span>${create.nameCompression(route.stops[1].name,14)}</span>`
				}
				else if (route.stops.length > 2)
				{
					let maxWeightStop = route.stops[1]
					for (let i=2 ; i<route.stops.length-1 ; i++)
					{
						if (route.stops[i].weight > maxWeightStop.weight)
						{
							maxWeightStop = route.stops[i]
						}
					}
					stopsText.innerHTML = `${route.stops.length}: <span>${create.nameCompression(route.stops[0].name,12)}</span> > <span>${create.nameCompression(maxWeightStop.name)}</span> > <span>${create.nameCompression(route.stops[route.stops.length-1].name)}</span>`
				}
				const time = create.element("div","time")
				li[2].appendChild(time)
				time.innerHTML = `${Math.round(route.totalSpace/60)}H (${Math.floor(route.space/60)}H ${addZero(Math.floor((route.space%60)))})`
				if (route.totalSpace > 605)
				{
					time.style.color = "#a75757"
				}
				else if (route.totalSpace > 540)
				{
					time.style.color = "#a77557"
				}
				const weight = create.element("div","weight")
				li[2].appendChild(weight)
				weight.innerHTML = `${route.totalWeight} t. / ${route.totalPallets} pal.`
				const gate = create.element("div","gate")
				li[2].appendChild(gate)
				gate.innerHTML = `R ${route.gate||"?"}`
				main.appendChild(ul)
			}
			create.markedFirm()
		},
		markedFirm: function()
		{
			const routes = document.getElementsByTagName("main")[0].getElementsByTagName("ul")
			for (const rout of routes)
			{
				if ((setings||{}).markedFirm === rout.dataset.firm)
				{
					rout.classList.add("markedFirm")
				}
				else
				{
					rout.classList.remove("markedFirm")
				}
			}
		},
		element: function(type,classList,id)
		{
			const element = document.createElement(type || "div")
			if (classList)
			{
				if (!Array.isArray(classList))
				{
					classList = [classList]
				}
				for (const c of classList)
				{
					element.classList.add(c)
				}
			}
			if (id)
			{
				element.id = id
			}
			return element
		},
		nameCompression: function(name, targetLength)
		{
			if (!name || typeof name !== "string") { return "ERROR"; }
			name = name.toUpperCase();
			targetLength = targetLength || 7;
			if (targetLength >= name.length)
			{
				return name
			}
			let parts = [];
			let number = "";
			let skip = false;

			for (let i = 0; i < name.length; i++)
			{
				if (name[i] === ")")
				{
					skip = false;
					continue;
				}
				if (skip)
				{
					continue;
				}
				if (Number(name[i]) || name[i] === "0")
				{
					number += name[i];
				}
				else if (name[i] === "(")
				{
					skip = true;
					continue;
				}
				else
				{
					if (name[i] === "R" && name[i + 1] === "Z")
					{
						parts.push(`${name[i]}${name[i + 1]}`);
						i++;
					}
					else if (name[i] === "C" && name[i + 1] === "H")
					{
						parts.push(`${name[i]}${name[i + 1]}`);
						i++;
					}
					else if ((name[i] === "S" || name[i] === "C") && name[i + 1] === "Z")
					{
						parts.push(`${name[i]}${name[i + 1]}`);
						i++;
					}
					else
					{
						parts.push(`${name[i]}`);
					}
				}
			}

			let cutOff = parts.length;
			for (let i = parts.length - 1; i > 3; i--)
			{
				if (parts[i] === " ")
				{
					cutOff = i;
				}
				else
				{
					break;
				}
			}

			parts = parts.slice(0, cutOff);
			number = Number(number);
			if (number === 1) { number = 0; }

			let result = "";
			for (let i = 0; i < parts.length; i++)
			{
				result += parts[i];
				if (i < parts.length - 4 && parts[i + 1] !== " " && (result.length > targetLength / 3 || `${result}${number || ""}`.length >= (targetLength - 2)))
				{
					if (/[aąeęiyou]/i.test(parts[i]))
					{
						if (parts[i + 1] !== " ")
						{
						    result += (parts[i + 1] || "");
						}
						else if (parts[i + 2] !== " ")
						{
						    result += `${(parts[i + 1] || "")} ${(parts[i + 2] || "")}`;
						}
						result += ".";
						break;
					}
				}
			}

			return `${result}${number || ""}`;
		},
		route: function(line,dateLine,myRoutes)
		{
			document.getElementById("firm").innerHTML = line.firm||"nieznany przewoźnik"
			let TopPosition = 100;
			const spacePosition = 40
			const route = document.getElementById("route");
			if (myRoutes)
			{
				route.classList.add("myRoutes")
			}
			else
			{
				route.classList.remove("myRoutes")
			}
			const canvas = route.getElementsByTagName("canvas")[0];
			canvas.classList.remove("hidden")
			const routeText = document.getElementById("routeText")
			routeText.innerHTML = ""
			routeText.classList.add("hidden")
			canvas.width = 500;
			canvas.height = TopPosition + ((line.stops.length+1) * spacePosition) + 15;
			const ctx = canvas.getContext('2d');
			// clear
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.fillStyle = "#1b1b1b"
			ctx.fillRect(0, 0, canvas.width, canvas.height);
			// nr
			ctx.fillStyle = "#b1b1b1"
			ctx.font = `22px Arial, Helvetica, sans-serif`;
			ctx.fillText(`#${line.nr}`, 10, 30);
			// weight
			ctx.fillText(`${line.totalWeight} t. / ${line.totalPallets} pal. (${Math.round(Number(line.difficulty)||0)}pkt)`, 10, 60);
			//date
			ctx.fillStyle = "white"
			ctx.fillText(`${dateText(line.date)||""}`, 55, 30);
			//hour
			ctx.font = `bold 25px Arial, Helvetica, sans-serif`;
			ctx.fillText(`${line.hour}`, 400, 30);
			//gate
			ctx.fillStyle = "#b11100"
			ctx.fillText(`R ${line.gate||0}`, 400, 60);
			routeText.innerHTML += `Trasa nr ${line.nr}. ${dateText(line.date)||""}<br>`
			routeText.innerHTML += `Godzina: ${line.hour} Rampa nr ${line.gate||0}<br>`
			routeText.innerHTML += `${line.totalWeight} t. / ${line.totalPallets} pal. (${Math.round(Number(line.difficulty)||0)}pkt)<br><br>`
			//stops
			for (let i=0 ; i<line.stops.length ; i++)
			{
				const stop = line.stops[i]
				//środek 330 szerokość 22 margines 2
				const startPalets = (307)+((stop.pallets)*12)
				ctx.font = `bold 27px "Courier New", monospace`;
				for (let j=0 ; j<stop.pallets ; j++)
				{
					ctx.fillStyle = "#434343"
					const h = 11+(((j+i)%2)*3)+(Math.max(0,3-j))+Math.min(10,Math.round((Math.max(0,(stop.weight/(stop.pallets||0.1))-1.5))*10))
					ctx.fillRect(startPalets-(24*j), TopPosition+8+(27-h), 20, h);
				}
				ctx.fillStyle = "white"
				ctx.font = `bold 20px "Courier New", monospace`;
				let up = ""
				if ((stop.weight/(stop.pallets||0.1))-2 > 0.3)
				{
					up = "+"
				}
				else if (stop.pallets>1 && (stop.weight/(stop.pallets||0.1))-2 < -0.3)
				{
					up = "-"
				}
				ctx.fillText(`${Math.floor((stop.weight||0.1)*100)}kg/${stop.pallets}${up}`, 285, TopPosition+27);
				//
				ctx.fillStyle = "#4d4d4d"
				ctx.fillRect(5, TopPosition, 440, 2);
				ctx.font = `bold 18px "Courier New", monospace`;
				//
				ctx.fillStyle = "#577f00"
				ctx.fillText(`+`, 452, TopPosition+5);
				if (stop.space > 25)
				{
					ctx.fillStyle = "#7f6100"
					ctx.fillText(`+`, 467, TopPosition+5);
				}
				if (stop.space > 40)
				{
					ctx.fillStyle = "#7f0000"
					ctx.fillText(`+`, 482, TopPosition+5);
				}
				ctx.fillStyle = "#4d4d4d"
				ctx.fillRect(5, TopPosition+spacePosition, 440, 2);
				ctx.fillStyle = "white"
				ctx.font = `20px "Courier New", monospace`;
				ctx.fillText(`${i+1}.`, 10, TopPosition+27);
				if (stop.type && stop.type!=="X")
				{
					ctx.fillText(`[${stop.type}]`, 55, TopPosition+27);
				}
				else
				{
					ctx.fillText(`[ ]`, 55, TopPosition+27);
				}
				ctx.font = `20px Arial, Helvetica, sans-serif`;
				ctx.fillText(`${create.nameCompression(stop.name,12)}`, 100, TopPosition+27);
				ctx.fillStyle = "gold"
				ctx.font = `20px Arial, Helvetica, sans-serif`;
				ctx.fillText(`${stop.hour}`, 400, TopPosition+27);
				TopPosition += spacePosition
				routeText.innerHTML += `${i+1}. ${stop.hour} - ${create.nameCompression(stop.name,14)} [${{X:" "}[stop.type]||stop.type}]<br>&nbsp;${Math.floor((stop.weight||0.1)*100)}kg / ${stop.pallets||0} pal.<br>`
			}
			const endDate = new Date(line.date*(60*60*1000))
			endDate.setHours(Number(line.hour.slice(0,2)))
			endDate.setMinutes(Number(line.hour.slice(3,5)) + line.totalSpace)
			ctx.font = `20px Arial, Helvetica, sans-serif`;
			ctx.fillStyle = "#434343"
			ctx.fillText(`Szacowany koniec - ${addZero(endDate.getHours())}:${addZero(endDate.getMinutes())} - ${Math.round(line.totalSpace/60)}H (${Math.floor(line.space/60)}H ${addZero(Math.floor((line.space%60)))})`, 10, TopPosition+27);
			route.classList.remove("hidden")
			document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("download")[0].onclick = function()
			{
				downloadCanvas(canvas,`${(line.stops[0]||{}).name||"trasa bez nazwy"} ${dateText(line.date)||""}`)
			}
			document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("copy")[0].onclick = function()
			{
				canvas.classList.add("hidden")
				document.getElementById("routeText").classList.remove("hidden")
				const routeText = document.getElementById("routeText")
				const text = routeText.innerText || routeText.textContent
				navigator.clipboard.writeText(text)
			}
			document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("share")[0].onclick = function()
			{
				const cleanUrl = window.location.origin + window.location.pathname;
				window.open(link.create(line), '_blank');
			}
			if (myRoutes)
			{
				document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("add")[0].style.opacity = 0
				document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("delete")[0].style.opacity = 1
				document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("delete")[0].onclick = function(event)
				{
					event.currentTarget.parentElement.parentElement.classList.add("hidden")
					const date = new Date((dateLine||line.date)*(1000*60*60))
					const month = date.getMonth()+1
					const year = date.getUTCFullYear()
					const day = date.getDate()
					//
					let thisMonth = 0
					for (let i=0 ; i<(data.myRoutes||[]).length ; i++)
					{
						if ((data.myRoutes[i]||{}).year === year && (data.myRoutes[i]||{}).month === month)
						{
							thisMonth = data.myRoutes[i]
						}
					}
					if (!thisMonth)
					{
						return
					}
					if (!Array.isArray(thisMonth.days[day]))
					{
						return
					}
					for (let i=0 ; i<thisMonth.days[day].length ; i++)
					{
						const copyDay =  []
						if (thisMonth.days[day][i].date != line.date)
						{
							copyDay.push(thisMonth.days[day][i])
						}
						thisMonth.days[day] = copyDay
					}
					localStorage.setItem("agroTrasy-data:myRoutes",JSON.stringify(data.myRoutes))
					menuActions.myRoutes()
				}
			}
			else
			{
				document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("delete")[0].style.opacity = 0
				document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("add")[0].style.opacity = 1
				document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("add")[0].onclick = function(event)
				{
					document.getElementById("route").classList.add("myRoutes")
					setTimeout(()=>{document.getElementById("route").getElementsByClassName("buttons")[0].getElementsByClassName("add")[0].style.opacity = 0},1000)
					const date = new Date((dateLine||line.date)*(1000*60*60))
					const month = date.getMonth()+1
					const year = date.getUTCFullYear()
					const day = date.getDate()
					//
					let thisMonth = 0
					for (let i=0 ; i<(data.myRoutes||[]).length ; i++)
					{
						if ((data.myRoutes[i]||{}).year === year && (data.myRoutes[i]||{}).month === month)
						{
							thisMonth = data.myRoutes[i]
						}
					}
					if (!thisMonth)
					{
						thisMonth = {year:year, month:month, days:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}
						data.myRoutes.unshift(thisMonth)
					}
					if (!Array.isArray(thisMonth.days[day]))
					{
						thisMonth.days[day] = []
					}
					let add = 1
					for (let i=0 ; i<thisMonth.days[day].length ; i++)
					{
						if (thisMonth.days[day][i].date === line.date)
						{
							thisMonth.days[day][i] = line
							add = 0
							break
						}
					}
					if (add)
					{
						thisMonth.days[day].push(line)
					}
					data.myRoutes.slice(0,13)
					localStorage.setItem("agroTrasy-data:myRoutes",JSON.stringify(data.myRoutes))
					data.myLastRoute = line
					localStorage.setItem("agroTrasy-data:myLastRoute",JSON.stringify(data.myLastRoute))
				}
			}
			return canvas
		}
	}
	const link =
	{
		create: function(line)
		{
			let code = addZero(line.nr||0)+line.hour.slice(0,2)+line.hour.slice(3,5)+addZero(line.gate||0)+(line.firm||"")+"!"
			code += `000${Math.floor(line.space)}`.slice(-3)+`000${Math.floor(line.totalSpace)}`.slice(-3)+`000${Math.floor(line.difficulty*10)}`.slice(-3)+Math.floor(line.date)+"!"
			for (const stop of line.stops)
			{
				code += stop.hour.slice(0,2)+stop.hour.slice(3,5)+addZero(stop.pallets||0)+`000${Math.floor(stop.weight*10)}`.slice(-3)+`000${Math.floor(stop.space)}`.slice(-3)+(stop.type||"X")+stop.name+"!"
			}
			return `${window.location.origin}${window.location.pathname}?r=${link.replaceOfPl(code.replace(/ /g, "_")).toLowerCase()}`
		},
		decode: function(code)
		{
			const line = {};
			const parts = link.replaceOnPl(code.replace(/_/g, " ").toUpperCase()).split("!");
			if (parts.length<3){return 0}

			const lineData = parts[0];
			line.nr = parseInt(lineData.slice(0, 2), 10);
			if (!line.nr){return 0}
			line.hour = `${lineData.slice(2, 4)}:${lineData.slice(4, 6)}`;
			line.gate = parseInt(lineData.slice(6, 8), 10);
			if (!line.gate){return 0}
			line.firm = lineData.slice(8);
			line.totalPallets = 0
			line.totalWeight = 0

			const spaceData = parts[1];
			line.space = parseInt(spaceData.slice(0, 3), 10);
			line.totalSpace = parseInt(spaceData.slice(3, 6), 10);
			line.difficulty = parseInt(spaceData.slice(6, 9), 10) / 10;
			line.date = parseInt(spaceData.slice(9), 10);

			line.stops = [];
			for (let i = 2; i < parts.length; i++)
			{
				const stopData = parts[i];
				if (!stopData || typeof stopData != "string" || stopData.length < 13)
				{
					continue
				}
				const stop = {};
				stop.hour = `${stopData.slice(0, 2)}:${stopData.slice(2, 4)}`;
				stop.pallets = parseInt(stopData.slice(4, 6), 10);
				stop.weight = parseInt(stopData.slice(6, 9), 10)/10;
				stop.space = parseInt(stopData.slice(9, 12), 10);
				stop.type = stopData.slice(12, 13);
				stop.name = stopData.slice(13);
				line.stops.push(stop);
				//
				line.totalPallets += stop.pallets
				line.totalWeight += stop.weight
			}
			line.totalWeight = Math.round(line.totalWeight)/10
			return line;
		},
		plChar:
		[
			["Ą","A"],
			["Ć","C"],
			["Ę","E"],
			["Ł","L"],
			["Ń","N"],
			["Ó","O"],
			["Ś","S"],
			["Ż","Z"],
			["Ź","X"],
		],
		replaceOfPl(code)
		{
			let giveBack = ""
			for (let i=0 ; i<code.length ; i++)
			{
				giveBack += searchChar(code[i])||code[i]
			}
			return giveBack
			function searchChar(originalChar)
			{
				for (const char of link.plChar)
				{
					if (originalChar === char[0])
					{
						return `Q${char[1]}`
					}
				}
			}
		},
		replaceOnPl(code)
		{
			let giveBack = ""
			for (let i=0 ; i<code.length ; i++)
			{
				if (code[i] === "Q")
				{
					giveBack += searchChar(code[i+1])||""
					i++
				}
				else
				{
					giveBack += code[i]
				}
			}
			return giveBack
			function searchChar(originalChar)
			{
				for (const char of link.plChar)
				{
					if (originalChar === char[1])
					{
						return `${char[0]}`
					}
				}
			}
		},
	}
	const statistic =
	{
		difficulty: function()
		{
			const difficulty = []
			for (const itinerary of data.itinerary)
			{
				for (const route of itinerary.list)
				{
					difficulty[Math.round(route.difficulty)] = (difficulty[Math.round(route.difficulty)]||0)+1
				}
			}
			for (let i=0 ; i<difficulty.length ; i++)
			{
				console.log(`${i}: ${"!".repeat(difficulty[i]||0)}`)
			}
		},
		weight: function()
		{
			const weight = []
			for (const itinerary of data.itinerary)
			{
				for (const route of itinerary.list)
				{
					for (const stop of route.stops)
					{
						const w = Math.round(((stop.weight*100)/stop.pallets)/10)
						weight[w] = (weight[w]||0)+1
					}
				}
			}
			for (let i=0 ; i<weight.length ; i++)
			{
				console.log(`${i*10}kg: ${"!".repeat((weight[i]||0)/4)}`)
			}
		},
	}
</script>
</head>
<body onload="load.start()">
	<main></main>
	<nav>
		<div id="nowTime">
			<span id="nowHour" style="color: gold;"></span>
			<span id="nowDay"></span>
		</div>
		<svg id="hamburger" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" data-path="menu">
			<polygon fill="white" points="0,0 0,20 100,20 100,0"></polygon>
			<polygon fill="white" points="0,40 0,60 100,60 100,40"></polygon>
			<polygon fill="white" points="0,80 0,100 100,100 100,80"></polygon>
		</svg>
	</nav>
	<div id="route" class="window hidden">
		<div class="close"></div>
		<span id="firm"></span>
		<canvas></canvas>
		<div id="routeText"></div>
		<div class="buttons">
			<svg class="add" viewBox="0 0 24 24">
				<path d="M7 12L12 12M12 12L17 12M12 12V7M12 12L12 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
			<svg class="download" viewBox="-5 -5 30 30">
				<path fill="white" d="M11 2a1 1 0 10-2 0v7.74L5.173 6.26a1 1 0 10-1.346 1.48l5.5 5a1 1 0 001.346 0l5.5-5a1 1 0 00-1.346-1.48L11 9.74V2zm-7.895 9.204A1 1 0 001.5 12v3.867a2.018 2.018 0 002.227 2.002c1.424-.147 3.96-.369 6.273-.369 2.386 0 5.248.236 6.795.383a2.013 2.013 0 002.205-2V12a1 1 0 10-2 0v3.884l-13.895-4.68zm0 0L2.5 11l.605.204zm0 0l13.892 4.683a.019.019 0 01-.007.005h-.006c-1.558-.148-4.499-.392-6.984-.392-2.416 0-5.034.23-6.478.38h-.009a.026.026 0 01-.013-.011V12a.998.998 0 00-.394-.796z"/>
			</svg>
			<svg class="copy" viewBox="-5 -5 34 34">
				<path fill="white" d="M17.093,1.293l-11.2,11.2a.99.99,0,0,0-.242.391l-1.6,4.8A1,1,0,0,0,5,19a1.014,1.014,0,0,0,.316-.051l4.8-1.6a1.006,1.006,0,0,0,.391-.242l11.2-11.2a1,1,0,0,0,0-1.414l-3.2-3.2A1,1,0,0,0,17.093,1.293ZM9.26,15.526l-2.679.893.893-2.679L17.8,3.414,19.586,5.2ZM3,21H20a1,1,0,0,1,0,2H3a1,1,0,0,1,0-2Z"></path>
			</svg>
			<svg class="share" viewBox="-10 -10 52 52">
				<path fill="white" d="M0 25.472q0 2.368 1.664 4.032t4.032 1.664h18.944q2.336 0 4-1.664t1.664-4.032v-8.192l-3.776 3.168v5.024q0 0.8-0.544 1.344t-1.344 0.576h-18.944q-0.8 0-1.344-0.576t-0.544-1.344v-18.944q0-0.768 0.544-1.344t1.344-0.544h9.472v-3.776h-9.472q-2.368 0-4.032 1.664t-1.664 4v18.944zM5.696 19.808q0 2.752 1.088 5.28 0.512-2.944 2.24-5.344t4.288-3.872 5.632-1.664v5.6l11.36-9.472-11.36-9.472v5.664q-2.688 0-5.152 1.056t-4.224 2.848-2.848 4.224-1.024 5.152zM32 22.080v0 0 0z"></path>
			</svg>
			<svg class="delete" viewBox="-3 -3 30 30">
				<path d="M10 11V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
				<path d="M14 11V17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
				<path d="M4 7H20" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
				<path d="M6 7H12H18V18C18 19.6569 16.6569 21 15 21H9C7.34315 21 6 19.6569 6 18V7Z" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
				<path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</div>
	</div>
	<div id="menu" class="window hidden" data-open="0">
		<section id="main">
			<h1>Menu główne</h1>
			<button data-action="myRoute">Moja trasa</button>
			<button data-action="routesNow">Ostatnia rozpiska</button>
			<button data-action="myRoutes">Moje trasy</button>
			<button data-path="other">inne</button>
			<span class="separator"></span>
			<button data-path="menu">Zamknij</button>
		</section>
		<section id="history" class="hidden">
			<h1>Wcześniejsze</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="markedFirm" class="hidden">
			<h1>Zaznacz przewoźnika</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="shareAll" class="hidden">
			<h1>Udostępnianie</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="itineraryText" class="hidden">
			<h1>Udostępnianie</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="ends" class="hidden">
			<h1>Zakończenia tras</h1>
			<button data-path="statistics">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="ramps" class="hidden">
			<h1>Zarządzanie rampami</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="newStops" class="hidden">
			<h1>Nowe sklepy</h1>
			<button data-path="statistics">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="chart" class="hidden">
			<h1>Wykresy</h1>
			<button data-path="statistics">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="double" class="hidden">
			<h1>Możliwe duble</h1>
			<button data-path="statistics">Cofnij</button>
			<span class="separator"></span>
			<div class="content"></div>
		</section>
		<section id="other" class="hidden">
			<h1>Inne</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<button data-action="loadFile">Wczytaj nową rozpiskę</button>
			<button data-path="history" data-action="history">Zobacz wcześniejsze</button>
			<button data-path="share">Udostępnianie</button>
			<button data-path="statistics">Statystyki</button>
			<button data-path="setings">Ustawienia</button>
			<button data-path="info">Informacje</button>
		</section>
		<section id="share" class="hidden">
			<h1>Udostępnianie</h1>
			<button data-path="other">Cofnij</button>
			<span class="separator"></span>
			<button data-path="itineraryText" data-action="itineraryText">Tekst tras</button>
			<button data-path="shareAll" data-action="shareAll">Udostępnij wszystkie</button>
			<button data-path="shareAll" data-action="shareFirm">Udostępnij przewoźnika</button>
			<button data-action="downloadAll">Pobierz wszystkie</button>
			<button data-action="downloadFirm">Pobierz przewoźnika</button>
		</section>
		<section id="setings" class="hidden">
			<h1>Ustawienia</h1>
			<button data-path="other">Cofnij</button>
			<span class="separator"></span>
			<button data-path="markedFirm" data-action="markedFirm">Zaznacz Przewoźnika</button>
			<button data-path="ramps" data-action="ramps">Zarządzanie rampami</button>
		</section>
		<section id="statistics" class="hidden">
			<h1>Statystyki</h1>
			<button data-path="other">Cofnij</button>
			<span class="separator"></span>
			<button data-path="ends" data-action="ends">Zakończenia tras</button>
			<button data-path="newStops" data-action="newStops">Nowe sklepy</button>
			<button data-path="chart" data-action="chartWeight">Wykres tonażu</button>
			<button data-path="chart" data-action="chartDifficulty">Wykres trudności</button>
			<button data-path="double" data-action="findDouble">Możliwe duble</button>
		</section>
		<section id="info" class="hidden">
			<h1>Informacje</h1>
			<button data-path="main">Cofnij</button>
			<span class="separator"></span>
			<h2>
				Informacje ogólne:<br>
				- Program umożliwia przeglądanie danych zapisanych w odpowiedniej formie w pliku CSV lub TSV.<br>
				- Program zapamiętuje 15 list z trasami według kolejności a nie daty rozpiski.<br>
				- Program pozwala zapisać pojedyńcze trasy klikając plus u dołu podglądu trasy. Przeglądanie zapisanych tras jest możliwe po wybraniu odpowiedniej opcji z menu.<br>
				- Usuwanie zapisanych tras jest możliwe po ich wyświetleniu i kliknięciu symbolu kubła na śmieci.<br>
				- Program pozwala zapisać trasę jako obrazek po kliknięciu symbolu pobierania na dole podglądu trasy.<br>
				- Program pozwala wyświetlić trasę w formie tekstowej i automatycznie kopiuje tekst do schowka po kliknięciu symbolu ołówka na dole podglądu trasy.<br>
				- Program pozwala udostępnić trasę klikająć ikonkę udostępnienia i wysyłając link otwartej strony.
			</h2>
			<h2>
				Sposób liczenia punktów:<br>
				- 3pkt za załadunek.<br>
				- 1pkt za 25min łącznej pracy.<br>
				- 1pkt za 15min pracy od pierwszego do ostatniego punktu.<br>
				- 1pkt za tonę.<br>
				- 0,25pkt za paletę.<br>
				- 0,25pkt za sklep.<br>
				- 0,2pkt za sklep bez wiaty lub 0.25pkt za sklep z kluczem.<br>
				- 0,2pkt za każdą paletę więcej niż 24.<br>
				- 1pkt jeżeli łączny czas trasy przewyższa 9 i pół godziny.<br>
			</h2>
			<h2>
				Sposób liczenia czasu:<br>
				Czas trasy to zaokrąglony do pełnych godzin czas od pierwszego do ostatniego punktu plus czas od załadunku do pierwszego punktu liczony podwójnie.<br>
				Czas podany w nawiasie to dokłądny czas od pierwszego do ostatniego punktu.
			</h2>
			<h2>
				Sposób liczenia ramp:<br>
				Rampy są przydzielane według nr trasy, nie kolejności ułożenia na liście.<br>
				Pliki nie zawierają nr rampy. Trzeba mieć na uwadze że nie zawsze będą się one zgadzać.
			</h2>
			<h2>
				Sposób przechowywania danych:<br>
				Dane są przechowywane lokalnie w pamięci przeglądarki urządzenia (localStorage).<br>
				Wyczyszczenie danych przeglądarki usunie wszystkie zapisane dane.<br>
				Informacje wprowadzane do programu nie są przesyłane na serwer.<br>
			</h2>
			<h2>
				Sposób udostępniania tras:<br>
				Dane o trasie są zawarte w linku w formacie JSON. Program odczytuje te dane i wyświetla.
			</h2>
		</section>
	</div>
	<div class="window hidden" id="inputWindow">
		<div class="close"></div>
		<h1>Wczytywanie</h1>
		<h2>Wczytaj plik z rozszerzeniem CSV lub TSV</h2>
		<input type="file" id="fileInput" accept=".csv, .tsv" multiple>
		<label for="fileInput" class="button">Wybierz plik</label>
	</div>
</body>
</html>
